<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MortgageAssist - AI-Powered Mortgage Support</title>
    <link rel="stylesheet" href="css/styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <header>
        <div class="container">
            <div class="logo"><a href="#"><span class="blue">MORTGAGE</span>ASSIST</a></div>
            <nav>
                <ul>
                    <li><a href="#features">Features</a></li>
                    <li><a href="#how-it-works">How It Works</a></li>
                    <li><a href="#testimonials">Testimonials</a></li>
                    <li><a href="#faq">FAQ</a></li>
                    <li><a href="#" class="btn-primary" id="howMuchBtn">How Much?</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <section class="hero">
        <div class="container">
            <div class="hero-content">
                <div class="key-icon">üîë</div>
                <h1>Mortgage Questions? Get Answers Instantly.</h1>
                <p>Skip the hold music. Our AI assistant helps with loan status, paperwork, and rate updates‚Äîday or night.</p>
                <a href="#chatbot" class="btn-primary">Ask Your Mortgage Question ‚Üí</a>
            </div>
        </div>
    </section>

    <section id="chatbot" class="chatbot-section">
        <div class="container">
            <h2>Ask Our AI Assistant</h2>
            
            <div class="chatbot-wrapper">
                <!-- Left chat bubble example -->
                <div class="example-chat-left">
                    <div class="user-message">
                        <div class="message-bubble blue">
                            What's my loan's interest rate?
                        </div>
                    </div>
                    <div class="ai-message">
                        <div class="message-bubble white border-green">
                            Your rate is 6.25% (30-year fixed).
                        </div>
                    </div>
                </div>
                
                <!-- Chatbase embed iframe -->
                <div class="chatbot-container">
                    <iframe
                        src="https://www.chatbase.co/chatbot-iframe/JKHQAJDGl0bRE-7LSQkv4"
                        width="100%"
                        style="height: 520px;"
                        frameborder="0"
                    ></iframe>
                </div>
                
                <!-- Right chat bubble example -->
                <div class="example-chat-right">
                    <div class="user-message">
                        <div class="message-bubble blue">
                            What documents do I need to upload?
                        </div>
                    </div>
                    <div class="ai-message">
                        <div class="message-bubble white border-green">
                            You're missing your 2023 W-2. Upload here.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <section id="features" class="benefits-section">
        <div class="container">
            <h2>Key Benefits</h2>
            <div class="benefits-grid">
                <div class="benefit-card">
                    <div class="benefit-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#0066ff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline>
                            <polyline points="17 6 23 6 23 12"></polyline>
                        </svg>
                    </div>
                    <h3>Loan Status Updates</h3>
                    <p>Get real-time updates on your application progress</p>
                    <div class="quote">"Where's my application in underwriting?"</div>
                </div>
                <div class="benefit-card">
                    <div class="benefit-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#0066ff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                            <polyline points="14 2 14 8 20 8"></polyline>
                            <line x1="16" y1="13" x2="8" y2="13"></line>
                            <line x1="16" y1="17" x2="8" y2="17"></line>
                            <polyline points="10 9 9 9 8 9"></polyline>
                        </svg>
                    </div>
                    <h3>Document Checklists</h3>
                    <p>Never miss important paperwork deadlines</p>
                    <div class="quote">"What's needed for closing?"</div>
                </div>
                <div class="benefit-card">
                    <div class="benefit-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#0066ff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <polyline points="17 18 11 12 17 6"></polyline>
                            <polyline points="7 6 1 12 7 18"></polyline>
                        </svg>
                    </div>
                    <h3>Rate Comparisons</h3>
                    <p>Make informed decisions about rate locking</p>
                    <div class="quote">"Should I lock my rate today?"</div>
                </div>
                <div class="benefit-card">
                    <div class="benefit-icon">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#0066ff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                            <rect x="2" y="3" width="20" height="14" rx="2" ry="2"></rect>
                            <line x1="8" y1="21" x2="16" y2="21"></line>
                            <line x1="12" y1="17" x2="12" y2="21"></line>
                        </svg>
                    </div>
                    <h3>Payment Calculators</h3>
                    <p>Instantly see how changes affect your payment</p>
                    <div class="quote">"What's my new monthly payment?"</div>
                </div>
            </div>
        </div>
    </section>

    <section id="how-it-works" class="how-it-works">
        <div class="container">
            <h2>How It Works</h2>
            <div class="steps-container">
                <div class="step">
                    <div class="step-number">1</div>
                    <h3>Ask</h3>
                    <p>Type your question (e.g., "Has my appraisal been scheduled?").</p>
                </div>
                <div class="step">
                    <div class="step-number">2</div>
                    <h3>Answer</h3>
                    <p>AI responds instantly with accurate details.</p>
                </div>
                <div class="step">
                    <div class="step-number">3</div>
                    <h3>Act</h3>
                    <p>Upload files or book a call if needed.</p>
                </div>
            </div>
        </div>
    </section>

    <section id="testimonials" class="testimonials">
        <div class="container">
            <h2>What Our Clients Say</h2>
            <div class="testimonial">
                <p class="quote">"Clients love the instant updates‚Äîour team saves 15+ hours/week!"</p>
                <p class="author">- [Loan Officer Name], [Company]</p>
            </div>
            <div class="stat">
                <div class="stat-number">40%</div>
                <div class="stat-description">fewer calls to our office since launch</div>
            </div>
        </div>
    </section>

    <section id="faq" class="faq-section">
        <div class="container">
            <h2>Frequently Asked Questions</h2>
            <div class="faq-grid">
                <div class="faq-item">
                    <h3>How do I lock my rate?</h3>
                    <p>You can lock your rate through our AI assistant or by contacting your loan officer directly. Rate locks typically last for 30, 45, or 60 days depending on your loan.</p>
                </div>
                <div class="faq-item">
                    <h3>What's the next step in my process?</h3>
                    <p>Our AI assistant can provide real-time updates on where you are in the mortgage process and what's needed next. Just ask "What's my next step?" or "What's my loan status?"</p>
                </div>
                <div class="faq-item">
                    <h3>Can I change my loan type?</h3>
                    <p>Yes, in many cases you can change your loan type during the application process. Ask our AI assistant about your options or schedule a call with your loan officer to discuss the benefits of different loan programs.</p>
                </div>
            </div>
        </div>
    </section>

    <footer>
        <div class="container">
            <div class="footer-info">
                <div class="footer-item">Secure & confidential</div>
                <div class="footer-item">NMLS-licensed expertise</div>
                <div class="footer-item">Bank-level encryption</div>
            </div>
        </div>
    </footer>

    <!-- Contact Form Modal - Using Netlify Forms -->
    <div id="contactModal" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <!-- Fine-Tunable Header with CSS Variables -->
<div style="display: flex; align-items: flex-start; justify-content: space-between; margin-bottom: 20px; padding: 10px 0;">
    
    <!-- LEFT SIDE: Business Logo + Get a Quote -->
    <div style="flex: 1;">
        <!-- BUSINESS LOGO - Adjustable -->
        <img src="https://odetjszursuaxpapfwcy.supabase.co/storage/v1/object/public/form-assets/logos/logo_5f42f026-051a-42c7-833d-375fcac74252_1754796297597_logo3.png" 
             style="
                height: 150px;                    /* ADJUST: Logo size (try 60px, 80px, 90px) */
                margin-bottom: 20px;             /* ADJUST: Space below logo (try 8px, 15px, 20px) */
                margin-left: -5px;                /* ADJUST: Logo left position (try 5px, 10px, -5px) */
                display: block;
             ">
        
        <!-- GET A QUOTE TEXT - Adjustable -->
        <h2 style="
            margin: 0; 
            font-size: 24px;                    /* ADJUST: Text size (try 20px, 26px, 28px) */
            color: #333; 
            text-align: left;
            margin-left: 0px;                   /* ADJUST: Text left position (try 5px, 10px, -5px) */
            margin-top: 5px;                    /* ADJUST: Space above text (try 0px, 10px, 15px) */
        ">Get a Quote</h2>
    </div>
    
    <!-- RIGHT SIDE: Avatar - Adjustable -->
    <div style="
        flex: 0 0 auto; 
        text-align: center;
        margin-right: 10px;                     /* ADJUST: Avatar right position (try 0px, 15px, 20px) */
        margin-top: -5px;                       /* ADJUST: Avatar vertical position (try 0px, -10px, 5px) */
    ">
        <img src="https://odetjszursuaxpapfwcy.supabase.co/storage/v1/object/public/avatars/avatar_1754795551491_AI%20assist%20with%20button.png" 
             onclick="activateAIAssistant()" 
             style="
                width: 110px;                   /* ADJUST: Avatar size (try 100px, 120px, 130px) */
                cursor: pointer; 
                border-radius: 10px; 
                transition: transform 0.3s;
             "
             onmouseover="this.style.transform='scale(1.05)'"
             onmouseout="this.style.transform='scale(1.0)'">
        <p style="
            margin: 3px 0 0 0; 
            font-size: 11px;                    /* ADJUST: Caption size (try 10px, 12px, 13px) */
            color: #666;
        ">üëã Click to activate AI!</p>
    </div>
    
</div>
            <!-- Using Netlify Forms -->
            <form id="contactForm" name="contact" method="POST" data-netlify="true">
                <!-- Netlify form name -->
                <input type="hidden" name="form-name" value="contact">
                
                <div class="form-group">
                    <label for="name">Your Name</label>
                    <input type="text" id="name" name="name" required>
                </div>
                <div class="form-group">
                    <label for="businessName">Business Name</label>
                    <input type="text" id="businessName" name="businessName" required>
                </div>
                <div class="form-group">
                    <label for="phone">Phone Number</label>
                    <input type="tel" id="phone" name="phone" required>
                </div>
                <div class="form-group">
                    <label for="bestTime">Best Time to Contact</label>
                    <input type="text" id="bestTime" name="bestTime" required>
                </div>
                <div class="form-group">
                    <label for="preferredDate">Preferred Date to Contact</label>
                    <input type="date" id="preferredDate" name="preferredDate" required>
                </div>
                <button type="submit" class="btn-primary btn-full">Submit</button>
            </form>
        </div>
    </div>

    <!-- Hidden form for Netlify Forms detection -->
    <form name="contact" netlify netlify-honeypot="bot-field" hidden>
        <input type="text" name="name" />
        <input type="text" name="businessName" />
        <input type="tel" name="phone" />
        <input type="text" name="bestTime" />
        <input type="date" name="preferredDate" />
    </form>

    <script src="js/main.js"></script>
    <!-- Removed the chatbot.js script since we're using the Chatbase iframe -->
<script>
// Enhanced AI Avatar System - FIXED VERSION
const mortgageKnowledge = {
    expertResponses: {
        "mortgage": "A mortgage is a loan to buy your home. You pay it back monthly over 15-30 years. Your payment includes principal, interest, taxes, and insurance.",
        "loan types": "Main types are: **Conventional** (3% down, 620+ credit), **FHA** (3.5% down, 580+ credit), **VA** (0% down for veterans), and **USDA** (0% down, rural areas).",
        "qualification": "You need good credit, stable income, acceptable debt-to-income ratio, and down payment. Most programs require 580+ credit score and 3-43% DTI.",
        "down payment": "Down payments range from 0-20%. FHA needs just 3.5%, conventional starts at 3%, VA and USDA can be 0%. The more you put down, the lower your monthly payment!",
        "credit score": "Credit requirements: Conventional (620+), FHA (580+), VA (no minimum), USDA (640+). Higher scores get better rates!",
        "interest rates": "Current mortgage rates are competitive! Rates depend on your credit score, down payment, and loan type. I can help you understand what affects your rate.",
        "closing costs": "Closing costs typically range from 1-5% of home price. This includes appraisal, title insurance, attorney fees, and lender charges.",
        "pmi": "Private Mortgage Insurance (PMI) is required if you put less than 20% down on conventional loans. It protects the lender and typically costs 0.5-1% annually.",
        "preapproval": "Pre-approval is stronger than pre-qualification! It means the lender verified your finances. Get pre-approved before house hunting for negotiating power."
    },
    
    formQuestions: [
        {field: 'name', question: "Let's start with your full name. What should I call you?"},
        {field: 'business', question: "Great! Now, what's your business or company name?"},
        {field: 'phone', question: "Perfect! What's the best phone number to reach you?"},
        {field: 'bestTime', question: "When's the best time to contact you?"},
        {field: 'preferredDate', question: "And what date would you prefer for us to contact you?"}
    ]
};

// Voice System Variables
let speechSynthesis = window.speechSynthesis;
let recognition = null;
let isVoiceChatMode = false;
let isListening = false;
let currentFormStep = 0;

// Initialize Speech Recognition
function initializeSpeechRecognition() {
    if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
        recognition = new (window.SpeechRecognition || window.webkitSpeechRecognition)();
        recognition.continuous = false;
        recognition.interimResults = false;
        recognition.lang = 'en-US';
        
        recognition.onresult = function(event) {
            const transcript = event.results[0][0].transcript.trim();
            console.log('User said:', transcript);
            
            if (isVoiceChatMode) {
                handleVoiceChatInput(transcript);
            }
        };
        
        recognition.onerror = function(event) {
            console.log('Speech recognition error:', event.error);
            stopListening();
        };
        
        recognition.onend = function() {
            isListening = false;
            updateListenButton();
        };
    }
}

// Main Avatar Activation Function
function activateAIAssistant() {
    initializeSpeechRecognition();
    showSimplifiedAIMenu();
}

// FIXED: Simplified 3-Button Menu
function showSimplifiedAIMenu() {
    closeAllAIInterfaces();
    
    const menuHTML = `
        <div id="aiOptionsMenu" style="
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 90%; max-width: 400px; background: white; border-radius: 20px;
            box-shadow: 0 15px 40px rgba(0,0,0,0.3); z-index: 10000; padding: 30px;
            text-align: center;
        ">
            <div style="margin-bottom: 25px;">
                <div style="font-size: 50px; margin-bottom: 10px;">ü§ñ</div>
                <h2 style="margin: 0; color: #333; font-size: 24px;">AI Mortgage Assistant</h2>
                <p style="color: #666; margin: 10px 0 0 0;">How can I help you today?</p>
            </div>
            
            <div style="display: flex; flex-direction: column; gap: 15px;">
                <!-- GREEN BUTTON: Help Fill Form -->
                <button onclick="startFormAssistant()" style="
                    background: linear-gradient(135deg, #4CAF50, #45a049); color: white; border: none;
                    padding: 20px 25px; border-radius: 15px; font-size: 18px; font-weight: bold;
                    cursor: pointer; transition: all 0.3s; box-shadow: 0 4px 15px rgba(76,175,80,0.3);
                " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                    üìù Help Me Fill The Form
                </button>
                
                <!-- BLUE BUTTON: Questions -->
                <button onclick="startQuestionChat()" style="
                    background: linear-gradient(135deg, #2196F3, #1976D2); color: white; border: none;
                    padding: 18px 25px; border-radius: 15px; font-size: 16px; cursor: pointer;
                    transition: all 0.3s; box-shadow: 0 4px 15px rgba(33,150,243,0.3);
                " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                    üí¨ I Have Questions
                </button>
                
                <!-- RED BUTTON: Close -->
                <button onclick="closeAllAIInterfaces()" style="
                    background: linear-gradient(135deg, #f44336, #d32f2f); color: white; border: none;
                    padding: 15px 25px; border-radius: 15px; font-size: 16px; cursor: pointer;
                    transition: all 0.3s; box-shadow: 0 4px 15px rgba(244,67,54,0.3);
                " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                    ‚ùå Close AI Assist
                </button>
            </div>
        </div>
        
        <div id="aiBackdrop" onclick="closeAllAIInterfaces()" style="
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); z-index: 9999;
        "></div>
    `;
    
    document.body.insertAdjacentHTML('beforeend', menuHTML);
}

// GREEN BUTTON: Form Assistant (Your existing form demo)
function startFormAssistant() {
    closeAllAIInterfaces();
    simulateAIFormFilling(); // Your existing function
}

// BLUE BUTTON: Question Chat with Voice Option
function startQuestionChat() {
    closeAllAIInterfaces();
    createEnhancedChatInterface();
    
    setTimeout(() => {
        addAIMessage("Hi! I'm your mortgage expert. You can type questions or click the microphone to speak with me! üé§");
        addAIMessage("I can help with: Loan types, qualification, down payments, interest rates, and more!");
        showMortgageQuickOptions();
    }, 500);
}

// FIXED: Enhanced Chat Interface with Voice
function createEnhancedChatInterface() {
    const chatHTML = `
        <div id="aiChatInterface" style="
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 90%; max-width: 500px; height: 600px; background: white; 
            border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            z-index: 10000; display: flex; flex-direction: column;
        ">
            <!-- Header -->
            <div style="
                background: linear-gradient(135deg, #2196F3, #1976D2); color: white; 
                padding: 15px; border-radius: 15px 15px 0 0; text-align: center; position: relative;
            ">
                <h3 style="margin: 0; font-size: 18px;">üí¨ Mortgage Expert Chat</h3>
                <button onclick="closeAllAIInterfaces()" style="
                    position: absolute; top: 10px; right: 15px; background: none; 
                    border: none; color: white; font-size: 24px; cursor: pointer;
                ">√ó</button>
            </div>
            
            <!-- Chat Messages -->
            <div id="chatMessages" style="
                flex: 1; padding: 15px; overflow-y: auto; background: #f8f9fa;
            "></div>
            
            <!-- Voice Indicator -->
            <div id="voiceIndicator" style="
                display: none; padding: 10px; background: #e8f5e8; border-top: 1px solid #ddd;
                text-align: center; color: #4CAF50; font-weight: bold;
            ">
                üé§ Listening... (speak now)
            </div>
            
            <!-- Input Area -->
            <div style="padding: 15px; border-top: 1px solid #eee; background: white;">
                <div style="display: flex; gap: 10px; align-items: center;">
                    <input type="text" id="userChatInput" placeholder="Ask about mortgages or click mic to speak..." 
                           style="flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 20px; font-size: 14px;"
                           onkeypress="if(event.key==='Enter') sendChatMessage()">
                    <button id="voiceChatButton" onclick="toggleVoiceChat()" style="
                        background: #4CAF50; color: white; border: none; border-radius: 50%;
                        width: 45px; height: 45px; cursor: pointer; font-size: 18px; transition: all 0.3s;
                    " title="Click to speak">üé§</button>
                    <button onclick="sendChatMessage()" style="
                        background: #2196F3; color: white; border: none; border-radius: 50%;
                        width: 45px; height: 45px; cursor: pointer; font-size: 16px;
                    ">‚Üí</button>
                </div>
                <div style="margin-top: 8px; font-size: 12px; color: #666; text-align: center;">
                    üí° Tip: Click the microphone and speak your question!
                </div>
            </div>
        </div>
        
        <div id="aiBackdrop" onclick="closeAllAIInterfaces()" style="
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); z-index: 9999;
        "></div>
    `;
    
    document.body.insertAdjacentHTML('beforeend', chatHTML);
    isVoiceChatMode = true;
    document.getElementById('userChatInput').focus();
}

// Voice Chat Functions
function toggleVoiceChat() {
    if (isListening) {
        stopVoiceChatListening();
    } else {
        startVoiceChatListening();
    }
}

function startVoiceChatListening() {
    if (!recognition) {
        addAIMessage("Sorry, voice recognition isn't supported in your browser. Please type your question instead.");
        return;
    }
    
    isListening = true;
    const indicator = document.getElementById('voiceIndicator');
    const button = document.getElementById('voiceChatButton');
    
    if (indicator) indicator.style.display = 'block';
    if (button) {
        button.innerHTML = 'üî¥';
        button.style.background = '#f44336';
        button.title = 'Click to stop listening';
    }
    
    try {
        recognition.start();
    } catch (error) {
        console.log('Recognition start error:', error);
        stopVoiceChatListening();
    }
}

function stopVoiceChatListening() {
    isListening = false;
    if (recognition) {
        try {
            recognition.stop();
        } catch (error) {
            console.log('Recognition stop error:', error);
        }
    }
    updateListenButton();
}

function updateListenButton() {
    const indicator = document.getElementById('voiceIndicator');
    const button = document.getElementById('voiceChatButton');
    
    if (indicator) indicator.style.display = 'none';
    if (button) {
        button.innerHTML = 'üé§';
        button.style.background = '#4CAF50';
        button.title = 'Click to speak';
    }
}

function handleVoiceChatInput(transcript) {
    // Show user message
    addUserMessage(transcript);
    
    // Get AI response
    setTimeout(() => {
        const response = getSmartAIResponse(transcript);
        addAIMessage(response);
        
        // Speak the response
        speakResponse(response);
    }, 800);
    
    stopVoiceChatListening();
}

// FIXED: Chat Message Functions
function sendChatMessage() {
    const input = document.getElementById('userChatInput');
    if (!input) return;
    
    const message = input.value.trim();
    if (!message) return;
    
    addUserMessage(message);
    input.value = '';
    
    setTimeout(() => {
        const response = getSmartAIResponse(message);
        addAIMessage(response);
    }, 800);
}

function addAIMessage(message) {
    const chatMessages = document.getElementById('chatMessages');
    if (!chatMessages) return;
    
    chatMessages.insertAdjacentHTML('beforeend', `
        <div style="margin-bottom: 15px;">
            <div style="display: flex; align-items: flex-start; gap: 10px;">
                <div style="
                    background: #4CAF50; color: white; border-radius: 50%; 
                    width: 30px; height: 30px; display: flex; align-items: center; 
                    justify-content: center; font-size: 14px; flex-shrink: 0;
                ">ü§ñ</div>
                <div style="
                    background: #e8f5e8; padding: 12px 16px; border-radius: 15px 15px 15px 5px;
                    max-width: 75%; font-size: 14px; line-height: 1.4; word-wrap: break-word;
                ">${message}</div>
            </div>
        </div>
    `);
    scrollChatToBottom();
}

function addUserMessage(message) {
    const chatMessages = document.getElementById('chatMessages');
    if (!chatMessages) return;
    
    chatMessages.insertAdjacentHTML('beforeend', `
        <div style="margin-bottom: 15px; text-align: right;">
            <div style="display: flex; align-items: flex-start; gap: 10px; justify-content: flex-end;">
                <div style="
                    background: #2196f3; color: white; padding: 12px 16px; 
                    border-radius: 15px 15px 5px 15px; max-width: 75%; 
                    font-size: 14px; line-height: 1.4; word-wrap: break-word;
                ">${message}</div>
                <div style="
                    background: #2196f3; color: white; border-radius: 50%; 
                    width: 30px; height: 30px; display: flex; align-items: center; 
                    justify-content: center; font-size: 14px; flex-shrink: 0;
                ">üë§</div>
            </div>
        </div>
    `);
    scrollChatToBottom();
}

// Enhanced AI Response System
function getSmartAIResponse(message) {
    const msg = message.toLowerCase();
    
    // Check for specific mortgage topics
    for (const [key, value] of Object.entries(mortgageKnowledge.expertResponses)) {
        if (msg.includes(key) || msg.includes(key.replace(/\s+/g, ''))) {
            return value;
        }
    }
    
    // Context-aware responses
    if (msg.includes('rate') || msg.includes('interest')) {
        return mortgageKnowledge.expertResponses['interest rates'];
    }
    if (msg.includes('qualify') || msg.includes('eligible')) {
        return mortgageKnowledge.expertResponses['qualification'];
    }
    if (msg.includes('fha') || msg.includes('va') || msg.includes('usda')) {
        return mortgageKnowledge.expertResponses['loan types'];
    }
    
    return "Great question! I'm here to help with mortgages, loan types, qualification, rates, and home buying. Could you be more specific? For example, ask me 'What credit score do I need?' or 'What are current rates?'";
}

// Quick Options for Chat
function showMortgageQuickOptions() {
    const options = `
        <div style="margin: 15px 0;">
            <p style="font-size: 12px; color: #666; margin-bottom: 8px;">Quick topics:</p>
            <button onclick="askQuickQuestion('What credit score do I need?')" class="chat-quick-btn">üìä Credit Score</button>
            <button onclick="askQuickQuestion('What loan types are available?')" class="chat-quick-btn">üìã Loan Types</button>
            <button onclick="askQuickQuestion('How much down payment?')" class="chat-quick-btn">üí∞ Down Payment</button>
            <button onclick="askQuickQuestion('What are current rates?')" class="chat-quick-btn">üìà Interest Rates</button>
        </div>
        
        <style>
            .chat-quick-btn {
                background: #e3f2fd; border: 1px solid #2196f3; border-radius: 20px;
                padding: 6px 12px; margin: 2px; font-size: 11px; cursor: pointer;
                color: #1976d2; transition: all 0.3s;
            }
            .chat-quick-btn:hover {
                background: #2196f3; color: white; transform: scale(1.05);
            }
        </style>
    `;
    
    const chatMessages = document.getElementById('chatMessages');
    if (chatMessages) {
        chatMessages.insertAdjacentHTML('beforeend', options);
        scrollChatToBottom();
    }
}

function askQuickQuestion(question) {
    addUserMessage(question);
    setTimeout(() => {
        const response = getSmartAIResponse(question);
        addAIMessage(response);
        speakResponse(response);
    }, 500);
}

// Voice Response
function speakResponse(text) {
    if (!speechSynthesis) return;
    
    // Clean text for speech (remove markdown and emojis)
    const cleanText = text.replace(/\*\*(.*?)\*\*/g, '$1').replace(/[üè†üìãüí∞üìäüìàüí¨ü§ñüë§]/g, '');
    
    const utterance = new SpeechSynthesisUtterance(cleanText);
    
    // Try to get a female voice
    const voices = speechSynthesis.getVoices();
    const femaleVoice = voices.find(voice => 
        voice.name.includes('Female') || 
        voice.name.includes('Samantha') || 
        voice.name.includes('Karen') ||
        voice.name.includes('Victoria')
    );
    
    if (femaleVoice) utterance.voice = femaleVoice;
    utterance.rate = 0.9;
    utterance.pitch = 1.0;
    utterance.volume = 0.8;
    
    speechSynthesis.speak(utterance);
}

// Utility Functions
function scrollChatToBottom() {
    const chatMessages = document.getElementById('chatMessages');
    if (chatMessages) {
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }
}

function closeAllAIInterfaces() {
    const interfaces = ['aiOptionsMenu', 'aiChatInterface', 'aiBackdrop'];
    interfaces.forEach(id => {
        const element = document.getElementById(id);
        if (element) element.remove();
    });
    
    // Stop voice systems
    if (recognition && isListening) {
        try {
            recognition.stop();
        } catch (error) {
            console.log('Error stopping recognition:', error);
        }
    }
    
    if (speechSynthesis) {
        speechSynthesis.cancel();
    }
    
    // Reset states
    isListening = false;
    isVoiceChatMode = false;
}

// Initialize when voices are loaded
speechSynthesis.onvoiceschanged = function() {
    console.log('Available voices:', speechSynthesis.getVoices().length);
};

// Initialize speech recognition on load
document.addEventListener('DOMContentLoaded', function() {
    initializeSpeechRecognition();
});
</script>

</body>
</html>

Hey guys! Looking good Richard ... you made it! 
https://solutionsproviders.wixsite.com/femalevoxfuryYay hoo! https://solutionsproviders.wixsite.com/risingfury
