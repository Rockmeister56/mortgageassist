<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LinkedIn War Room ¬∑ Botemia Sales ¬∑ Server Ready</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(145deg, #0a1a2a 0%, #0f2b4b 100%);
            color: white;
            padding: 30px 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo h1 {
            font-size: 2.2rem;
            font-weight: 700;
            background: linear-gradient(135deg, #fff, #0a66c2);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .badge {
            background: rgba(10, 102, 194, 0.15);
            border: 1px solid #0a66c2;
            color: #7fc1ff;
            padding: 8px 20px;
            border-radius: 40px;
            font-weight: 600;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .server-sync-bar {
            background: rgba(10,102,194,0.15);
            border: 1px solid #0a66c2;
            border-radius: 12px;
            padding: 16px 24px;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 16px;
        }

        .sync-status {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #7fc1ff;
        }

        .sync-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: #00c853;
            box-shadow: 0 0 10px #00c853;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255,255,255,0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.08);
            border-radius: 20px;
            padding: 20px;
            border-bottom: 3px solid #0a66c2;
        }

        .stat-number {
            font-size: 2.2rem;
            font-weight: 700;
            color: #0a66c2;
            margin-bottom: 5px;
        }

        .stat-label {
            color: rgba(255,255,255,0.7);
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .campaign-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 25px;
            margin-bottom: 30px;
        }

        .campaign-card {
            background: rgba(18, 28, 46, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.05);
            border-radius: 20px;
            padding: 24px;
        }

        .campaign-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding-bottom: 16px;
        }

        .campaign-icon {
            font-size: 1.8rem;
        }

        .campaign-title {
            font-size: 1.3rem;
            font-weight: 600;
            color: white;
        }

        .campaign-stats {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .campaign-stat {
            text-align: center;
        }

        .campaign-stat-number {
            font-size: 1.6rem;
            font-weight: 700;
            color: #0a66c2;
        }

        .campaign-stat-label {
            font-size: 0.75rem;
            color: rgba(255,255,255,0.6);
            text-transform: uppercase;
        }

        .progress-bar {
            background: rgba(0,0,0,0.3);
            height: 8px;
            border-radius: 4px;
            margin: 15px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #0a66c2, #4c9aff);
            width: 0%;
            border-radius: 4px;
        }

        .prospect-table-container {
            background: rgba(18, 28, 46, 0.8);
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 30px;
            overflow-x: auto;
        }

        .prospect-table {
            width: 100%;
            border-collapse: collapse;
        }

        .prospect-table th {
            text-align: left;
            padding: 12px;
            color: rgba(255,255,255,0.7);
            font-weight: 600;
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .prospect-table td {
            padding: 12px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            color: rgba(255,255,255,0.9);
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 30px;
            font-size: 0.75rem;
            font-weight: 600;
            display: inline-block;
        }

        .status-connected {
            background: rgba(10,102,194,0.15);
            color: #7fc1ff;
            border: 1px solid #0a66c2;
        }

        .status-replied {
            background: rgba(0,200,83,0.15);
            color: #00c853;
            border: 1px solid #00c853;
        }

        .status-interested {
            background: rgba(248,196,0,0.15);
            color: #f8c400;
            border: 1px solid #f8c400;
        }

        .status-demo {
            background: rgba(0,200,83,0.15);
            color: #00c853;
            border: 1px solid #00c853;
        }

        .status-closed {
            background: rgba(255,255,255,0.15);
            color: white;
            border: 1px solid white;
        }

        .btn {
            background: rgba(10,102,194,0.1);
            border: 1px solid #0a66c2;
            color: #7fc1ff;
            padding: 8px 16px;
            border-radius: 30px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            margin-right: 8px;
        }

        .btn:hover {
            background: #0a66c2;
            color: white;
        }

        .btn-small {
            padding: 4px 12px;
            font-size: 0.7rem;
        }

        .btn-success {
            background: rgba(0,200,83,0.15);
            border: 1px solid #00c853;
            color: #00c853;
        }

        .btn-success:hover {
            background: #00c853;
            color: black;
        }

        .btn-primary {
            background: linear-gradient(145deg, #0a66c2, #054a91);
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 40px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .sequence-section {
            background: rgba(18, 28, 46, 0.8);
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 30px;
        }

        .sequence-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-top: 20px;
        }

        .sequence-step {
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            padding: 16px;
            border-left: 3px solid #0a66c2;
        }

        .step-day {
            color: #0a66c2;
            font-weight: 700;
            font-size: 0.8rem;
            margin-bottom: 8px;
        }

        .step-message {
            color: white;
            font-size: 0.9rem;
            margin-bottom: 12px;
            font-style: italic;
        }

        .step-stats {
            color: rgba(255,255,255,0.5);
            font-size: 0.75rem;
        }

        .quick-add-section {
            background: rgba(18, 28, 46, 0.8);
            border-radius: 20px;
            padding: 24px;
            margin-bottom: 40px;
        }

        .quick-add-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-top: 16px;
        }

        .quick-add-grid input,
        .quick-add-grid select {
            background: rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 10px;
            padding: 12px;
            color: white;
            font-size: 0.95rem;
        }

        .quick-add-grid input::placeholder {
            color: rgba(255,255,255,0.5);
        }

        .action-buttons {
            display: flex;
            gap: 16px;
            justify-content: flex-end;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .data-management {
            background: rgba(0,0,0,0.2);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 30px;
        }

        .server-config {
            background: rgba(10,102,194,0.05);
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 30px;
            border: 1px dashed #0a66c2;
        }

        @media (max-width: 1200px) {
            .stats-grid { grid-template-columns: repeat(3, 1fr); }
            .campaign-grid { grid-template-columns: 1fr; }
            .sequence-grid { grid-template-columns: repeat(2, 1fr); }
        }

        @media (max-width: 800px) {
            .stats-grid { grid-template-columns: repeat(2, 1fr); }
            .sequence-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">
                <div style="font-size: 2.5rem;">üîµ</div>
                <h1>LinkedIn War Room</h1>
            </div>
            <div class="badge">
                <span>üéØ BOTEMIA OUTBOUND ENGINE</span>
                <span style="margin-left: 8px;">v2.0 ¬∑ SERVER READY</span>
            </div>
        </div>

        <!-- SERVER SYNC BAR -->
        <div class="server-sync-bar" id="serverSyncBar">
            <div style="display: flex; align-items: center; gap: 16px;">
                <div class="sync-dot"></div>
                <span class="sync-status" id="syncStatus">üü¢ Auto-save active ¬∑ LocalStorage</span>
            </div>
            <div style="display: flex; gap: 12px;">
                <button class="btn" onclick="configureServer()">
                    <i class="fas fa-plug"></i> Connect Server
                </button>
                <button class="btn-success" onclick="exportFullBackup()">
                    <i class="fas fa-database"></i> Export Backup
                </button>
            </div>
        </div>

        <!-- MASTER STATS -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="totalConnections">847</div>
                <div class="stat-label">Connection Requests</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalAccepted">312</div>
                <div class="stat-label">Accepted (36.8%)</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalReplies">98</div>
                <div class="stat-label">Replies</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalInterested">47</div>
                <div class="stat-label">Interested</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="totalDemos">23</div>
                <div class="stat-label">Demos</div>
            </div>
        </div>

        <!-- CAMPAIGN GRID -->
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
            <h2 style="color: white; display: flex; align-items: center; gap: 10px;">
                <span>üöÄ</span> Active Outreach Campaigns
            </h2>
            <button class="btn" onclick="addCampaign()">
                <i class="fas fa-plus"></i> + New Campaign
            </button>
        </div>

        <div class="campaign-grid" id="campaignGrid"></div>

        <!-- PROSPECTS TABLE -->
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
            <h2 style="color: white; display: flex; align-items: center; gap: 10px;">
                <span>üìã</span> Active Prospects ¬∑ In Progress
            </h2>
            <button class="btn btn-success" onclick="focusQuickAdd()">
                <i class="fas fa-user-plus"></i> + Add Prospect
            </button>
        </div>

        <div class="prospect-table-container">
            <table class="prospect-table">
                <thead>
                    <tr>
                        <th>NAME</th>
                        <th>TITLE</th>
                        <th>COMPANY</th>
                        <th>CAMPAIGN</th>
                        <th>STATUS</th>
                        <th>LAST CONTACT</th>
                        <th>NEXT STEP</th>
                        <th>ACTIONS</th>
                    </tr>
                </thead>
                <tbody id="prospectTableBody"></tbody>
            </table>
        </div>

        <!-- OUTBOUND SEQUENCE -->
        <div class="sequence-section">
            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px;">
                <span style="font-size: 1.8rem;">‚è±Ô∏è</span>
                <h2 style="color: white; margin: 0;">LinkedIn Outreach Sequence ¬∑ Mortgage Brokers</h2>
            </div>

            <div class="sequence-grid">
                <div class="sequence-step">
                    <div class="step-day">DAY 1 ¬∑ Connection</div>
                    <div class="step-message">"Hey [Name], saw your work at [Company]. I'm helping mortgage brokers close 94% of qualified apps with AI. Would love to connect."</div>
                    <div class="step-stats" id="step1Stats">312 sent ¬∑ 186 accepted</div>
                </div>
                <div class="sequence-step">
                    <div class="step-day">DAY 3 ¬∑ DM Follow-up</div>
                    <div class="step-message">"Thanks for connecting! Quick question ‚Äî are you currently using any AI for lead follow-up or pre-qualification? We built something called Botemia that's been a game changer."</div>
                    <div class="step-stats" id="step2Stats">186 sent ¬∑ 58 replies</div>
                </div>
                <div class="sequence-step">
                    <div class="step-day">DAY 5 ¬∑ Value Add</div>
                    <div class="step-message">"Here's a quick 2-min demo of how Botemia works. She asks for their name, answers rate questions, and routes ready buyers to your LOs. No typing. No friction."</div>
                    <div class="step-stats" id="step3Stats">58 sent ¬∑ 31 interested</div>
                </div>
                <div class="sequence-step">
                    <div class="step-day">DAY 7 ¬∑ Call to Action</div>
                    <div class="step-message">"Want to see what she'd look like on your site? Happy to spin up a demo instance for you. Got 10 minutes this week?"</div>
                    <div class="step-stats" id="step4Stats">31 sent ¬∑ 23 demos</div>
                </div>
            </div>
        </div>

        <!-- QUICK ADD PROSPECT -->
        <div class="quick-add-section">
            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px;">
                <span style="font-size: 1.5rem;">‚ö°</span>
                <h3 style="color: white; margin: 0;">Quick Add Prospect</h3>
            </div>
            <div class="quick-add-grid">
                <input type="text" id="prospectName" placeholder="Full Name">
                <input type="text" id="prospectTitle" placeholder="Title">
                <input type="text" id="prospectCompany" placeholder="Company">
                <select id="prospectCampaign">
                    <option value="Mortgage Brokers ¬∑ Q1 2024">Mortgage Brokers ¬∑ Q1 2024</option>
                    <option value="Branch Managers ¬∑ East Coast">Branch Managers ¬∑ East Coast</option>
                    <option value="New Campaign">+ New Campaign</option>
                </select>
                <select id="prospectStatus">
                    <option value="Connected">‚úÖ Connected</option>
                    <option value="Awaiting Reply">‚è≥ Awaiting Reply</option>
                    <option value="Interested">üî• Interested</option>
                    <option value="Demo Scheduled">üìÖ Demo Scheduled</option>
                </select>
                <button class="btn-success" onclick="quickAddProspect()" style="padding: 12px; border-radius: 10px;">
                    <i class="fas fa-plus-circle"></i> Add Prospect
                </button>
            </div>
        </div>

        <!-- DATA MANAGEMENT -->
        <div class="data-management">
            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px;">
                <span style="font-size: 1.5rem;">üíæ</span>
                <h3 style="color: white; margin: 0;">Data Management</h3>
            </div>
            <div style="display: flex; gap: 16px; flex-wrap: wrap;">
                <button class="btn-primary" onclick="exportFullBackup()">
                    <i class="fas fa-download"></i> Download Full Backup (.json)
                </button>
                <div style="position: relative; overflow: hidden; display: inline-block;">
                    <button class="btn" onclick="document.getElementById('importFile').click()">
                        <i class="fas fa-upload"></i> Import Backup
                    </button>
                    <input type="file" id="importFile" accept=".json" style="position: absolute; opacity: 0; width: 0.1px; height: 0.1px;" onchange="importBackup(event)">
                </div>
                <button class="btn" onclick="exportCSV()">
                    <i class="fas fa-file-csv"></i> Export CSV
                </button>
                <button class="btn" onclick="resetToDemo()">
                    <i class="fas fa-undo"></i> Reset to Demo
                </button>
            </div>
        </div>

        <!-- SERVER CONFIGURATION -->
        <div class="server-config">
            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 16px;">
                <span style="font-size: 1.3rem;">‚òÅÔ∏è</span>
                <h4 style="color: white; margin: 0;">Server Sync Configuration</h4>
            </div>
            <div style="display: flex; gap: 16px; flex-wrap: wrap; align-items: flex-end;">
                <div style="flex: 1;">
                    <label style="display: block; color: rgba(255,255,255,0.7); font-size: 0.8rem; margin-bottom: 6px;">Server URL</label>
                    <input type="text" id="serverUrl" placeholder="https://your-mortgage-site.com/data/" value="https://your-mortgage-site.com/data/" style="width: 100%; background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; padding: 12px; color: white;">
                </div>
                <div>
                    <label style="display: block; color: rgba(255,255,255,0.7); font-size: 0.8rem; margin-bottom: 6px;">Client ID</label>
                    <input type="text" id="clientId" placeholder="mortgage-assist" value="mortgage-assist" style="width: 200px; background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1); border-radius: 8px; padding: 12px; color: white;">
                </div>
                <button class="btn" onclick="testServerConnection()">
                    <i class="fas fa-plug"></i> Test Connection
                </button>
                <button class="btn-success" onclick="syncToServer()">
                    <i class="fas fa-cloud-upload-alt"></i> Sync Now
                </button>
            </div>
            <p style="color: rgba(255,255,255,0.5); margin-top: 16px; font-size: 0.85rem;">
                <i class="fas fa-info-circle"></i> Data auto-saves to browser. Server sync stores all campaigns and prospects on your server.
            </p>
        </div>

        <!-- EVABOOT INTEGRATION -->
        <div style="background: linear-gradient(145deg, rgba(10,102,194,0.1), rgba(0,0,0,0.2)); border-radius: 20px; padding: 24px; margin-bottom: 30px; border: 1px solid #0a66c2;">
            <div style="display: flex; align-items: center; gap: 20px; flex-wrap: wrap;">
                <div style="background: #0a66c2; width: 50px; height: 50px; border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.8rem;">
                    üìä
                </div>
                <div style="flex: 1;">
                    <h3 style="color: white; margin-bottom: 8px;">Evaboot + Apollo Pipeline</h3>
                    <p style="color: rgba(255,255,255,0.7);">Import 500 mortgage broker contacts from Sales Navigator in 2 clicks</p>
                </div>
                <button class="btn-primary" onclick="importEvabootSample()">
                    <i class="fas fa-file-import"></i> Import Sample
                </button>
                <button class="btn" onclick="window.open('https://evaboot.com', '_blank')">
                    <i class="fas fa-external-link-alt"></i> Open Evaboot
                </button>
            </div>
        </div>

        <div style="margin-top: 30px; color: rgba(255,255,255,0.5); font-size: 0.8rem; text-align: center; border-top: 1px solid rgba(255,255,255,0.05); padding-top: 30px;">
            <p>üîµ LinkedIn War Room ¬∑ v2.0 ¬∑ Auto-save enabled ¬∑ Server ready ¬∑ 37% accept rate ¬∑ $49 Evaboot = $83k pipeline</p>
        </div>
    </div>

    <script>
        // ===== LINKEDIN WAR ROOM ¬∑ FULL DATA PERSISTENCE =====
        const STORAGE_KEY = 'botemia_linkedin_data';
        let SERVER_URL = localStorage.getItem('botemia_linkedin_server_url') || 'https://your-mortgage-site.com/data/';
        let CLIENT_ID = localStorage.getItem('botemia_linkedin_client_id') || 'mortgage-assist';

        // Default demo data
        const defaultData = {
            campaigns: [
                {
                    id: 'camp1',
                    name: 'Mortgage Brokers ¬∑ Q1 2024',
                    icon: 'üè†',
                    sent: 500,
                    accepted: 186,
                    replies: 58,
                    demos: 14,
                    target: 14,
                    color: '#0a66c2'
                },
                {
                    id: 'camp2',
                    name: 'Branch Managers ¬∑ East Coast',
                    icon: 'üè¶',
                    sent: 250,
                    accepted: 89,
                    replies: 31,
                    demos: 7,
                    target: 8,
                    color: '#0a66c2'
                }
            ],
            prospects: [
                { name: 'Michael Chen', title: 'Branch Manager', company: 'CrossCountry Mortgage', campaign: 'Branch Managers ¬∑ East Coast', status: 'Connected', lastContact: 'Feb 12', nextStep: 'DM Day 3', date: '2024-02-12' },
                { name: 'Sarah Rodriguez', title: 'Senior Loan Officer', company: 'Fairway Independent', campaign: 'Mortgage Brokers ¬∑ Q1 2024', status: 'Replied', lastContact: 'Feb 11', nextStep: 'Send Demo', date: '2024-02-11' },
                { name: 'David Kim', title: 'Owner/Broker', company: 'Premier Lending', campaign: 'Mortgage Brokers ¬∑ Q1 2024', status: 'Interested', lastContact: 'Feb 10', nextStep: 'Demo Feb 15', date: '2024-02-10' },
                { name: 'Jennifer Walsh', title: 'Regional Manager', company: 'Guaranteed Rate', campaign: 'Branch Managers ¬∑ East Coast', status: 'Demo Scheduled', lastContact: 'Feb 09', nextStep: 'Follow-up', date: '2024-02-09' },
                { name: 'Robert Taylor', title: 'Mortgage Broker', company: 'Nexa Mortgage', campaign: 'Mortgage Brokers ¬∑ Q1 2024', status: 'Connected', lastContact: 'Feb 12', nextStep: 'DM Day 2', date: '2024-02-12' },
                { name: 'Lisa Wong', title: 'Loan Officer', company: 'AmeriSave', campaign: 'Mortgage Brokers ¬∑ Q1 2024', status: 'Awaiting Reply', lastContact: 'Feb 11', nextStep: 'Follow-up Day 3', date: '2024-02-11' },
                { name: 'James Martinez', title: 'Branch Manager', company: 'New American Funding', campaign: 'Branch Managers ¬∑ East Coast', status: 'Interested', lastContact: 'Feb 10', nextStep: 'Demo Feb 16', date: '2024-02-10' }
            ],
            stats: {
                connections: 847,
                accepted: 312,
                replies: 98,
                interested: 47,
                demos: 23,
                closes: 4
            },
            sequence: {
                step1: { sent: 312, accepted: 186 },
                step2: { sent: 186, replies: 58 },
                step3: { sent: 58, interested: 31 },
                step4: { sent: 31, demos: 23 }
            },
            lastUpdated: new Date().toISOString()
        };

        // Load data on startup
        let appData = loadData();

        // ===== PERSISTENCE ENGINE =====
        function loadData() {
            const saved = localStorage.getItem(STORAGE_KEY);
            if (saved) {
                try {
                    const data = JSON.parse(saved);
                    document.getElementById('serverUrl').value = data.serverUrl || SERVER_URL;
                    document.getElementById('clientId').value = data.clientId || CLIENT_ID;
                    SERVER_URL = data.serverUrl || SERVER_URL;
                    CLIENT_ID = data.clientId || CLIENT_ID;
                    updateSyncStatus('üü¢ Data loaded from localStorage');
                    return data;
                } catch(e) {
                    console.error('Error loading data:', e);
                }
            }
            // First time - save default data
            saveData(defaultData);
            return defaultData;
        }

        function saveData(data) {
            data.lastUpdated = new Date().toISOString();
            data.serverUrl = document.getElementById('serverUrl')?.value || SERVER_URL;
            data.clientId = document.getElementById('clientId')?.value || CLIENT_ID;
            localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
            appData = data;
            renderAll();
            updateSyncStatus('üü¢ Auto-saved to localStorage');
            
            // Save server settings
            localStorage.setItem('botemia_linkedin_server_url', data.serverUrl);
            localStorage.setItem('botemia_linkedin_client_id', data.clientId);
        }

        function saveCurrentState() {
            const data = {
                campaigns: appData.campaigns,
                prospects: appData.prospects,
                stats: getCurrentStats(),
                sequence: appData.sequence,
                serverUrl: document.getElementById('serverUrl').value,
                clientId: document.getElementById('clientId').value
            };
            saveData(data);
        }

        // ===== RENDER FUNCTIONS =====
        function renderAll() {
            renderCampaigns();
            renderProspects();
            renderStats();
            renderSequence();
        }

        function renderCampaigns() {
            const grid = document.getElementById('campaignGrid');
            grid.innerHTML = '';
            
            appData.campaigns.forEach((campaign, index) => {
                const acceptRate = campaign.sent > 0 ? Math.round((campaign.accepted / campaign.sent) * 100) : 0;
                const progress = campaign.target > 0 ? Math.round((campaign.demos / campaign.target) * 100) : 0;
                
                const card = document.createElement('div');
                card.className = 'campaign-card';
                card.innerHTML = `
                    <div class="campaign-header">
                        <div class="campaign-icon">${campaign.icon}</div>
                        <div class="campaign-title">${campaign.name}</div>
                    </div>
                    <div class="campaign-stats">
                        <div class="campaign-stat">
                            <div class="campaign-stat-number">${campaign.sent}</div>
                            <div class="campaign-stat-label">Sent</div>
                        </div>
                        <div class="campaign-stat">
                            <div class="campaign-stat-number">${campaign.accepted}</div>
                            <div class="campaign-stat-label">Accepted</div>
                        </div>
                        <div class="campaign-stat">
                            <div class="campaign-stat-number">${campaign.replies}</div>
                            <div class="campaign-stat-label">Replies</div>
                        </div>
                        <div class="campaign-stat">
                            <div class="campaign-stat-number">${campaign.demos}</div>
                            <div class="campaign-stat-label">Demos</div>
                        </div>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${progress}%;"></div>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-top: 8px;">
                        <span style="color: rgba(255,255,255,0.6);">Accept rate: ${acceptRate}%</span>
                        <span style="color: #0a66c2; font-weight: 600;">${campaign.demos}/${campaign.target} closes</span>
                    </div>
                    <div style="display: flex; gap: 8px; margin-top: 16px;">
                        <button class="btn btn-small" onclick="incrementCampaignStat(${index}, 'sent')">+ Sent</button>
                        <button class="btn btn-small" onclick="incrementCampaignStat(${index}, 'accepted')">+ Accepted</button>
                        <button class="btn btn-small" onclick="incrementCampaignStat(${index}, 'replies')">+ Reply</button>
                        <button class="btn btn-small" onclick="incrementCampaignStat(${index}, 'demos')">+ Demo</button>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        function renderProspects() {
            const tbody = document.getElementById('prospectTableBody');
            tbody.innerHTML = '';
            
            appData.prospects.forEach((prospect, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><strong>${prospect.name}</strong></td>
                    <td>${prospect.title}</td>
                    <td>${prospect.company}</td>
                    <td>${prospect.campaign}</td>
                    <td><span class="status-badge status-${getStatusClass(prospect.status)}">${getStatusIcon(prospect.status)} ${prospect.status}</span></td>
                    <td>${prospect.lastContact}</td>
                    <td>${prospect.nextStep}</td>
                    <td>
                        <button class="btn btn-small" onclick="updateProspectStatus(${index})">‚Üª Update</button>
                        <button class="btn btn-small" onclick="deleteProspect(${index})" style="border-color: #f44336; color: #f44336;">‚úï</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function renderStats() {
            const stats = appData.stats;
            document.getElementById('totalConnections').innerText = stats.connections;
            document.getElementById('totalAccepted').innerText = stats.accepted;
            document.getElementById('totalReplies').innerText = stats.replies;
            document.getElementById('totalInterested').innerText = stats.interested;
            document.getElementById('totalDemos').innerText = stats.demos;
        }

        function renderSequence() {
            const seq = appData.sequence;
            document.getElementById('step1Stats').innerHTML = `${seq.step1.sent} sent ¬∑ ${seq.step1.accepted} accepted`;
            document.getElementById('step2Stats').innerHTML = `${seq.step2.sent} sent ¬∑ ${seq.step2.replies} replies`;
            document.getElementById('step3Stats').innerHTML = `${seq.step3.sent} sent ¬∑ ${seq.step3.interested} interested`;
            document.getElementById('step4Stats').innerHTML = `${seq.step4.sent} sent ¬∑ ${seq.step4.demos} demos`;
        }

        // ===== ACTIONS =====
        function addCampaign() {
            const name = prompt('Enter campaign name:', 'Mortgage Brokers ¬∑ West Coast');
            if (!name) return;
            
            appData.campaigns.push({
                id: 'camp' + Date.now(),
                name: name,
                icon: 'üìå',
                sent: 0,
                accepted: 0,
                replies: 0,
                demos: 0,
                target: 10,
                color: '#0a66c2'
            });
            saveCurrentState();
        }

        function incrementCampaignStat(index, stat) {
            appData.campaigns[index][stat]++;
            
            // Update global stats
            if (stat === 'sent') appData.stats.connections++;
            if (stat === 'accepted') appData.stats.accepted++;
            if (stat === 'replies') appData.stats.replies++;
            if (stat === 'demos') appData.stats.demos++;
            
            // Update sequence stats
            if (stat === 'sent') appData.sequence.step1.sent++;
            if (stat === 'accepted') appData.sequence.step1.accepted++;
            if (stat === 'replies') appData.sequence.step2.replies++;
            if (stat === 'demos') appData.sequence.step4.demos++;
            
            saveCurrentState();
        }

        function quickAddProspect() {
            const name = document.getElementById('prospectName').value;
            const title = document.getElementById('prospectTitle').value;
            const company = document.getElementById('prospectCompany').value;
            const campaign = document.getElementById('prospectCampaign').value;
            const status = document.getElementById('prospectStatus').value;
            
            if (!name || !title || !company) {
                alert('Please fill in name, title, and company');
                return;
            }
            
            const today = new Date();
            const formattedDate = today.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
            const isoDate = today.toISOString().split('T')[0];
            
            appData.prospects.unshift({
                name: name,
                title: title,
                company: company,
                campaign: campaign,
                status: status,
                lastContact: formattedDate,
                nextStep: status === 'Connected' ? 'DM Day 1' : 'Follow-up',
                date: isoDate
            });
            
            // Clear inputs
            document.getElementById('prospectName').value = '';
            document.getElementById('prospectTitle').value = '';
            document.getElementById('prospectCompany').value = '';
            
            saveCurrentState();
        }

        function updateProspectStatus(index) {
            const prospect = appData.prospects[index];
            const statuses = ['Connected', 'Awaiting Reply', 'Replied', 'Interested', 'Demo Scheduled', 'Demo Done', 'Closed'];
            const currentIndex = statuses.indexOf(prospect.status);
            
            if (currentIndex < statuses.length - 1) {
                prospect.status = statuses[currentIndex + 1];
                
                // Update stats
                if (prospect.status === 'Replied') appData.stats.replies++;
                if (prospect.status === 'Interested') appData.stats.interested++;
                if (prospect.status === 'Demo Scheduled') appData.stats.demos++;
                if (prospect.status === 'Demo Done') appData.stats.closes++;
                
                // Update next step
                if (prospect.status === 'Connected') prospect.nextStep = 'DM Day 1';
                if (prospect.status === 'Awaiting Reply') prospect.nextStep = 'Follow-up Day 2';
                if (prospect.status === 'Replied') prospect.nextStep = 'Send Demo';
                if (prospect.status === 'Interested') prospect.nextStep = 'Schedule Demo';
                if (prospect.status === 'Demo Scheduled') prospect.nextStep = 'Demo Call';
                if (prospect.status === 'Demo Done') prospect.nextStep = 'Follow-up Close';
                if (prospect.status === 'Closed') prospect.nextStep = '‚úì Done';
                
                saveCurrentState();
            }
        }

        function deleteProspect(index) {
            if (confirm('Delete this prospect?')) {
                appData.prospects.splice(index, 1);
                saveCurrentState();
            }
        }

        function focusQuickAdd() {
            document.getElementById('prospectName').focus();
        }

        // ===== DATA EXPORT/IMPORT =====
        function exportFullBackup() {
            const backup = {
                version: '2.0',
                tool: 'LinkedIn War Room',
                timestamp: new Date().toISOString(),
                data: appData,
                serverUrl: document.getElementById('serverUrl').value,
                clientId: document.getElementById('clientId').value
            };
            
            const blob = new Blob([JSON.stringify(backup, null, 2)], { type: 'application/json' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `linkedin-war-room-backup-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
        }

        function importBackup(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const backup = JSON.parse(e.target.result);
                    if (backup.data) {
                        saveData(backup.data);
                        alert('‚úÖ Backup imported successfully!');
                    }
                } catch(e) {
                    alert('‚ùå Invalid backup file');
                }
            };
            reader.readAsText(file);
            event.target.value = '';
        }

        function exportCSV() {
            let csv = 'Name,Title,Company,Campaign,Status,Last Contact,Next Step,Date Added\n';
            
            appData.prospects.forEach(p => {
                csv += `"${p.name}","${p.title}","${p.company}","${p.campaign}","${p.status}","${p.lastContact}","${p.nextStep}","${p.date}"\n`;
            });
            
            const blob = new Blob([csv], { type: 'text/csv' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `linkedin-prospects-${new Date().toISOString().split('T')[0]}.csv`;
            link.click();
        }

        // ===== SERVER SYNC =====
        function configureServer() {
            const url = prompt('Enter your server URL (e.g., https://your-site.com/data/):', SERVER_URL);
            if (url) {
                SERVER_URL = url;
                localStorage.setItem('botemia_linkedin_server_url', url);
                document.getElementById('serverUrl').value = url;
                updateSyncStatus('üü° Server URL configured');
            }
        }

        async function testServerConnection() {
            const url = document.getElementById('serverUrl').value;
            updateSyncStatus('üü° Testing connection...');
            
            try {
                const response = await fetch(url + 'test-connection.json?' + Date.now(), { 
                    method: 'HEAD',
                    mode: 'no-cors'
                });
                updateSyncStatus('üü¢ Server reachable (CORS mode)');
            } catch(e) {
                updateSyncStatus('üî¥ Server unreachable - check URL');
            }
        }

        async function syncToServer() {
            const url = document.getElementById('serverUrl').value;
            const clientId = document.getElementById('clientId').value;
            
            updateSyncStatus('üü° Syncing to server...');
            
            // Save to localStorage first
            saveCurrentState();
            
            // Export backup as sync method
            exportFullBackup();
            
            updateSyncStatus('üü¢ Backup exported - upload to server');
        }

        // ===== EVABOOT INTEGRATION =====
        function importEvabootSample() {
            const sampleProspects = [
                { name: 'Thomas Anderson', title: 'Branch Manager', company: 'Movement Mortgage', campaign: 'Mortgage Brokers ¬∑ Q1 2024', status: 'Connected', lastContact: 'Today', nextStep: 'DM Day 1', date: new Date().toISOString().split('T')[0] },
                { name: 'Patricia Lewis', title: 'Senior Loan Officer', company: 'Caliber Home Loans', campaign: 'Mortgage Brokers ¬∑ Q1 2024', status: 'Connected', lastContact: 'Today', nextStep: 'DM Day 1', date: new Date().toISOString().split('T')[0] },
                { name: 'Kevin Zhang', title: 'Mortgage Broker', company: 'Kind Lending', campaign: 'Mortgage Brokers ¬∑ Q1 2024', status: 'Connected', lastContact: 'Today', nextStep: 'DM Day 1', date: new Date().toISOString().split('T')[0] }
            ];
            
            appData.prospects = [...sampleProspects, ...appData.prospects];
            appData.stats.connections += 3;
            appData.stats.accepted += 3;
            appData.sequence.step1.sent += 3;
            appData.sequence.step1.accepted += 3;
            
            saveCurrentState();
            alert('‚úÖ Imported 3 sample prospects from Evaboot');
        }

        // ===== UTILITIES =====
        function getCurrentStats() {
            return appData.stats;
        }

        function getStatusClass(status) {
            const map = {
                'Connected': 'connected',
                'Awaiting Reply': 'connected',
                'Replied': 'replied',
                'Interested': 'interested',
                'Demo Scheduled': 'demo',
                'Demo Done': 'demo',
                'Closed': 'closed'
            };
            return map[status] || 'connected';
        }

        function getStatusIcon(status) {
            const icons = {
                'Connected': '‚úÖ',
                'Awaiting Reply': '‚è≥',
                'Replied': 'üí¨',
                'Interested': 'üî•',
                'Demo Scheduled': 'üìÖ',
                'Demo Done': '‚úÖ',
                'Closed': 'üí∞'
            };
            return icons[status] || '‚óè';
        }

        function updateSyncStatus(message) {
            const statusEl = document.getElementById('syncStatus');
            if (statusEl) statusEl.innerHTML = message;
        }

        function resetToDemo() {
            if (confirm('Reset to demo data? Your current data will be backed up first.')) {
                exportFullBackup();
                saveData(defaultData);
            }
        }

        // Auto-save on page unload
        window.addEventListener('beforeunload', () => {
            saveCurrentState();
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            // Load server settings
            document.getElementById('serverUrl').value = SERVER_URL;
            document.getElementById('clientId').value = CLIENT_ID;
            
            // Add Font Awesome
            const link = document.createElement('link');
            link.rel = 'stylesheet';
            link.href = 'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css';
            document.head.appendChild(link);
            
            renderAll();
            updateSyncStatus('üü¢ Ready ¬∑ Auto-save enabled');
        });
    </script>
</body>
</html>